<div class="row justify-content: space-around">
  <%= render "shared/sidebar" %>
    <div class="card-project col-6">
      <div class='project-spec'>
       <% if @project.photo.present? && @project.photo.attached? %>
          <div class="card-category" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(<%= cl_image_path(@project.photo.key) %>)">
        <% else %>
          <div class="card-category" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(<%= image_path('travaux.png') %>)">
        <% end %>

        <h1><%= @project.title %></h1>
      </div>
          <p>Description : <br><i><%= @project.description %>.</i></p>
          <div class="project-spec-info">
            <div class="project-spec-info-category">
              <i class="fa-solid fa-location-pin"></i>
              <p><%= @project.location %></p>
            </div>
            <div class="project-spec-info-category">
              <i class="fa-solid fa-wallet"></i>
              <p><%= @project.budget %> â‚¬</p>
            </div>
            <div class="project-spec-info-category">
              <i class="fa-regular fa-calendar"></i>
              <p><%= Date.parse(@project.start_date).strftime("%d %B %Y") %></p>
            </div>
          </div>
            <h2 class="fonts">Mes travaux</h2>
          <div class="project-spec-info">

            <% @project_works.each do |project_work| %>
              <div class="project-spec-info-works">
                <div class="project-spec-info-works-icon">
                  <%= image_tag image_for_work(project_work), width: 35, height: 35, class: "ldslkdssdk" %>
                </div>
                <h4><strong><%= project_work.name %></strong></h4>
                <ul>
                  <% artisans_for_work = User.where(skill: project_work.name) %>
                  <% artisans_for_work.each do |artisan| %>





            <div class='project-spec-info-entreprise'>
                    <li>
                      <p>Company Name: <%= artisan.company_name %></p>
                      <% project_request = ProjectRequest.find_by(user_id: artisan.id, project_id: @project.id) %>
                      <p>Status: <%= project_request.status if project_request %></p>

                      <%# Reviews %>


                    <% if project_request %>
                      <% if project_request.review %>
                        <p>Rating:
                          <% rating = project_request.review.rating.to_i %>
                          <% (1..5).each do |i| %>
                            <% if i <= rating %>
                              <i class="fas fa-star"></i>
                            <% else %>
                              <i class="far fa-star"></i>
                            <% end %>
                          <% end %>
                        </p>
                        <p>Comment: <%= project_request.review.comment %></p>
                      <% else %>
                            <%= link_to "Donner mon avis", new_project_request_review_path(project_request), class: "btn-main" %>
                          <% end %>
                    <% end %>



                    </li>
                </div>

                  <% end %>
                </ul>
              </div>
            <% end %>
          </div>
          <h4>Vos photos</h4>
          <%= cl_image_tag @project.photo.key, height: 300, width: 400, crop: :fill %>
      </div>

    </div>
    <div class="chat-project col-3" data-controller="project-subscription" data-project-subscription-project-id-value="<%= @project.id %>">
      <div class='inline-elements'>
        <h2>Chat</h2>
        <i class="fa-regular fa-comments"></i>
      </div>
          <div class="messages" data-project-subscription-target="messages">
            <% @project.messages.each do |message| %>
              <%= render "messages/message", message: message %>
            <% end %>
          </div>
          <%= simple_form_for [@project, @message], html: { class: "d-flex align-items-end" } do |f| %>
            <%= f.input :content,
                        label: false,
                        placeholder: "Message",
                        input_html: { class: "form-control flex-grow-1 mr-2" } %>
            <%= f.submit "Envoyer", class: "btn-main" %>
          <% end %>

    </div>

</div>
